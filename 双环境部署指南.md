# WHartTest VitePress 双环境部署指南

## 🎯 解决方案概述

现在支持 **GitHub Pages** 和 **面板** 双环境部署，互不影响！

通过环境变量自动切换 `base` 路径：
- **GitHub Pages**: `base: '/WHartTest/'` 
- **面板**: `base: './'` (相对路径)

## 🔧 配置修改说明

### VitePress配置 (`docs/.vitepress/config.mjs`)
```javascript
base: process.env.DEPLOY_TYPE === 'baota' ? './' : '/WHartTest/',
```

### Package.json 新增脚本
```json
"scripts": {
  "docs:build:github": "node deploy-scripts/build-github.js",
  "docs:build:baota": "node deploy-scripts/build-baota.js"
}
```

## 🚀 使用方法

### GitHub Pages 部署（保持原有方式）
```bash
# 使用GitHub专用构建脚本
npm run docs:build:github

# 或者使用标准构建（默认GitHub配置）
npm run docs:build
```

### 面板部署
```bash
# 使用宝塔专用构建脚本
npm run docs:build:baota
```

## 📋 面板详细部署步骤

### 步骤1：构建项目
```bash
# 使用宝塔专用构建
npm run docs:build:baota
```

### 步骤2：上传文件到宝塔
1. 登录面板
2. 进入"文件"管理
3. 将 `docs/.vitepress/dist` 目录上传到 `/www/wwwroot/`
4. 重命名为 `wharttest-docs`

### 步骤3：添加站点
1. 点击"网站" → "添加站点"
2. 填写域名
3. 根目录选择：`/www/wwwroot/wharttest-docs`
4. 点击"提交"

### 步骤4：配置Nginx
使用提供的 `baota-nginx.conf` 配置文件，或者手动配置：

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    root /www/wwwroot/wharttest-docs;
    index index.html;
    
    # 处理SPA路由
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

## 🔍 常见问题排查

### 问题1：样式仍然加载不出来
- ✅ 确认使用了 `npm run docs:build:baota` 构建
- ✅ 检查浏览器控制台是否有404错误
- ✅ 确认Nginx根目录路径正确

### 问题2：页面刷新404
- ✅ 确保Nginx配置中有 `try_files $uri $uri/ /index.html;`

### 问题3：GitHub Pages失效
- ✅ 确认使用 `npm run docs:build:github` 构建GitHub版本
- ✅ 不要混用构建脚本

## 📁 项目结构说明

```
WHartTest/
├── docs/                          # VitePress文档目录
│   ├── .vitepress/
│   │   └── config.mjs            # 主配置文件（支持双环境）
│   └── ...                       # 文档内容
├── deploy-scripts/               # 部署脚本
│   ├── build-github.js          # GitHub Pages构建脚本
│   └── build-baota.js           # 面板构建脚本
├── baota-nginx.conf             # 宝塔Nginx配置模板
└── package.json                 # 包含新的构建脚本
```

## 💡 最佳实践

1. **GitHub Pages**: 使用 `npm run docs:build:github`
2. **面板**: 使用 `npm run docs:build:baota`
3. **本地开发**: 使用 `npm run docs:dev`

两种部署方式完全独立，互不影响！🎉